---
title: "Visualización"
author: "Elizaveta, Javier y Adrián"
date: "2/5/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Inicio librerías

```{r, warning=FALSE}
library(ggplot2)
library(ggmap)
library(dplyr)
library(coefplot)
library(readr)
library(knitr)
```

Descarga de datasets actualizados

```{r, warning=FALSE}
covid <- read.csv("https://raw.githubusercontent.com/Covid19R/coronavirus/master/csv/coronavirus.csv", stringsAsFactors = FALSE)

covid$date <- as.Date(covid$date)


covid2 <- read.csv("https://raw.githubusercontent.com/owid/covid-19-data/7d57bf19c5ec110069e81e1ec145b6b8d61219fa/public/data/owid-covid-data.csv")
```

Extraemos los datos más actuales correspondientes a España

```{r}
ultimos_datos <- top_n(filter(covid2, iso_code=="ESP"),1, date)
```

Casos y muertes actuales en España

```{r}
ultimos_datos$total_cases
ultimos_datos$total_deaths
```

Nuevos casos y muertes en España

```{r}
ultimos_datos$new_cases
ultimos_datos$new_deaths
```

Extraigo los datos actuales totales de cada país

```{r}
datos_actuales <- top_n(covid2, 1, date)
datos_actuales_totales <- select(datos_actuales, iso_code, location, date, total_cases, total_deaths)
```

Y los ordeno por el número de casos totales

```{r}
arrange(datos_actuales_totales, desc(total_cases))
```

También extraigo el número de nuevos casos

```{r}
datos_actuales_nuevos <- select(datos_actuales, iso_code, location, date, new_cases, new_deaths)
```

Y los ordeno por el número de casos nuevos en el último día

```{r}
arrange(datos_actuales_nuevos, desc(new_cases))
```




Gráfico casos confirmados, muertos y recuperados en todo el mundo segun los dias.

```{r,eval=TRUE}
grafico <- ggplot(covid,aes(x=date, y=cases))
grafico + geom_point(aes(color = type))

            
```

Gráfico 10 países con más casos totales de infectados

```{r}
grafico2 <- ggplot(top_n(filter(datos_actuales, location!="World"),10,total_cases), aes(x=iso_code, y=total_cases)) + geom_col(aes(color=iso_code))
grafico2
```

Gráfico 10 países con más casos de infectados en este último día

```{r}
grafico3 <- ggplot(top_n(filter(datos_actuales, location!="World"),10,new_cases), aes(x=iso_code, y=new_cases)) + geom_col(aes(color=iso_code))
grafico3
```


********************************

Escojo el mapa y lo que deseo coger del dataset.

```{r,eval=TRUE}
us = map_data("world")

casos = covid %>%
filter(type=="death")
  

casos

```

Pongo la base 
```{r,eval=TRUE}

mundo = ggplot()
#must define map first
mundo = mundo + geom_map(data=us, map=us,aes(x=long, y=lat, map_id=region),fill="#ffffff",color="#ffffff", size=0.15)

mundo
```
Coloreo el mapa mundi

```{r,eval=TRUE}

g = mundo + geom_map(data=casos, map=us,
aes(fill=cases, map_id=Country.Region),
color="#ffffff", size=0.15)
g
```
!!!NO COMPLICA BIEN¡¡¡HAY QUE ARREGLARLO.


Desde este sitio [transparencias](https://web.stanford.edu/~imalone/VAM/VAMSlides.pdf).
