---
title: "Visualización"
author: "Elizaveta, Javier y Adrián"
date: "2/5/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Inicio librerías

```{r, warning=FALSE}
library(ggplot2)
library(ggmap)
library(dplyr)
library(coefplot)
library(readr)
library(knitr)
library(ggthemes)
library(gganimate)
library(maps)
```

Descarga de datasets actualizados

```{r, warning=FALSE}
covid <- read.csv("https://raw.githubusercontent.com/Covid19R/coronavirus/master/csv/coronavirus.csv", stringsAsFactors = FALSE)
covid$date <- as.Date(covid$date)
covid2 <- read.csv("https://raw.githubusercontent.com/owid/covid-19-data/7d57bf19c5ec110069e81e1ec145b6b8d61219fa/public/data/owid-covid-data.csv")
```

Extraemos los datos más actuales correspondientes a España

```{r}
ultimos_datos <- top_n(filter(covid2, iso_code=="ESP"),1, date)
```

Casos y muertes actuales en España

```{r}
ultimos_datos$total_cases
ultimos_datos$total_deaths
```

Nuevos casos y muertes en España

```{r}
ultimos_datos$new_cases
ultimos_datos$new_deaths
```

Extraigo los datos actuales totales de cada país

```{r}
datos_actuales <- top_n(covid2, 1, date)
datos_actuales_totales <- select(datos_actuales, iso_code, location, date, total_cases, total_deaths)
```

Y los ordeno por el número de casos totales

```{r}
arrange(datos_actuales_totales, desc(total_cases))
```

También extraigo el número de nuevos casos

```{r}
datos_actuales_nuevos <- select(datos_actuales, iso_code, location, date, new_cases, new_deaths)
```

Y los ordeno por el número de casos nuevos en el último día

```{r}
arrange(datos_actuales_nuevos, desc(new_cases))
```


¿Qué pais tiene más casos?

```{r}
peor_pais <- arrange(covid2,desc(covid2$total_cases))

peor_pais <- filter(peor_pais,location!="World")

peor_pais$location[1]
```


¿Cuantas muertes ha conllevado el virus?

```{r}
covid2$total_deaths
```

¿Cuantos casos ha conllevado el virus?

```{r}
covid2$total_cases
```


¿Que pais ha realizado mas test en proporcion?


```{r}
mas_test<-arrange(covid2,desc(covid2$total_tests_per_thousand))
mas_test$location[1]
```

¿Y mas test?

```{r}
mas_test2<-arrange(covid2,desc(covid2$total_tests))
mas_test2$location[1]
```



Gráfico casos confirmados, muertos y recuperados en todo el mundo segun los dias.

```{r,eval=TRUE}
grafico <- ggplot(covid,aes(x=date, y=cases))
grafico + geom_point(aes(color = type))
            
```

Gráfico 10 países con más casos totales de infectados

```{r}
grafico2 <- ggplot(top_n(filter(datos_actuales, location!="World"),10,total_cases), aes(x=iso_code, y=total_cases)) + geom_col(aes(fill=iso_code)) + ggtitle("Top 10 países con más casos totales de COVID-19") + theme(plot.title=element_text(color="blue", face="bold")) + labs(x="Países", y="Casos Totales") + theme(axis.title.x = element_text(color="blue"), axis.title.y = element_text(color="blue")) + scale_fill_discrete(guide = guide_legend(title = "Países", keywidth = 2))

grafico2
```

Gráfico 10 países con más casos de infectados en este último día

```{r}
grafico3 <- ggplot(top_n(filter(datos_actuales, location!="World"),10,new_cases), aes(x=iso_code, y=new_cases)) + geom_col(aes(fill=iso_code)) + ggtitle("Top 10 países con nuevos casos de COVID-19") + theme(plot.title=element_text(color="blue", face="bold")) + labs(x="Países", y="Nuevos Casos") + theme(axis.title.x = element_text(color="blue"), axis.title.y = element_text(color="blue")) + scale_fill_discrete(guide = guide_legend(title = "Países", keywidth = 2))

grafico3
```



Gráfica que muestra el numero de nuevos casos diarios en el mundo

```{r}



df<-filter(covid2,covid2$location=="World")

ggplot(df,aes(date,new_cases)) +xlab("fecha") + ylab("casos")+ geom_point(aes(color=new_cases))+  theme_minimal() 

```



Gráfica que muestra el numero de nuevos casos diarios en el España

```{r}




df<-filter(covid2,covid2$location=="Spain")

ggplot(df,aes(date,new_cases)) +xlab("fecha") + ylab("casos")+ geom_point(aes(color=new_cases))+  theme_minimal() 

```






********************************
Selecciono los datos del dataset para poder hacer el mapa dinamico.

```{r}

map <- covid %>%
  group_by(date, Lat,Long) %>%
  arrange(date,Country.Region) %>%
  distinct()
map$date <- as.Date(covid$date)
map$latitude <- as.numeric(covid$Lat) 
map$longitude <- as.numeric(covid$Long) 
```
Escojo un mapa del mundo general: 
```{r}
ggplot() +
  borders("world", colour = "gray90", fill = "gray85") +
  theme_map()
  ```

Añado un mapa mismo estatico: 

```{r}
ggplot(data = map) +
  borders("world", colour = "gray90", fill = "gray85") +
  theme_map() + 
  geom_point(aes(x = longitude, y = latitude, size = cases), 
             colour = "#351C4D", alpha = 0.55) +
  labs(size = "Casos") +
  ggtitle("Casos totales COVID-19") 

```
Mapa dinamico listo: 
```{r}

ggplot() +
  borders("world", colour = "gray90", fill = "gray85") +
  theme_map() + 
  geom_point(data = map, aes(x = longitude, y = latitude, size = cases), 
             colour = "#351C4D", alpha = 0.5) +
  labs(title = "Date: {frame_time}", size = "Casos") +
  transition_time(date) +
  ease_aes("linear")

```

