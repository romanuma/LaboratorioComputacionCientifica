---
title: "Regresion"
output: html_document
---

# Cargamos los paquetes

```{r, warning=FALSE}
library(dplyr)
```

# Cargamos las librerías

```{r}
rango_edades <- read.csv("https://raw.githubusercontent.com/datadista/datasets/master/COVID%2019/nacional_covid19_rango_edad.csv")

names(rango_edades) <- c("fecha","rango_edad","sexo","casos_confirmados","hospitalizados","ingresos_uzi","fallecidos")
attach(rango_edades)
```

# Tratamiento de librería

Para empezar vamos a calcular el total de todas las variables con respecto a los rangos de edad a los que pertenecen.

```{r}
gr <- group_by(rango_edades, rango_edad)
gr <- filter(gr, sexo=="ambos", rango_edad!="Total")
```


```{r}
edades <- c((0+9)/2,(10+19)/2,(20+29)/2,(30+39)/2,(40+49)/2,(50+59)/2,(60+69)/2,(70+79)/2,(80+89)/2,(80+89)/2,(90+99)/2)
sum_casos <- summarise(gr, sum=sum(casos_confirmados))
sum_casos <- mutate(sum_casos, edades=edades)
sum_casos <- transmute(sum_casos, edades, sum)
sum_casos
sum_hospitalizados <- summarise(gr, sum=sum(hospitalizados))
sum_hospitalizados <- mutate(sum_hospitalizados, edades=edades)
sum_hospitalizados <- transmute(sum_hospitalizados, edades, sum)
sum_hospitalizados
sum_ingresos <- summarise(gr, sum=sum(ingresos_uzi))
sum_ingresos <- mutate(sum_ingresos, edades=edades)
sum_ingresos <- transmute(sum_ingresos, edades, sum)
sum_ingresos
sum_fallecidos <- summarise(gr, sum=sum(fallecidos))
sum_fallecidos <- mutate(sum_fallecidos, edades=edades)
sum_fallecidos <- transmute(sum_fallecidos, edades, sum)
sum_fallecidos
```


# Comenzamos con el análisis exploratorio

Primero vemos las varibles con las que contamos, del tipo que son y en el rango de valores en el que se mueven.

```{r}
str(gr)
summary(gr)
quantile(gr$casos_confirmados)
quantile(gr$hospitalizados)
quantile(gr$ingresos_uzi)
quantile(gr$fallecidos)
```

Ahora podemos hacer los plot para comprobar si puede existir alguna regresión

```{r}
plot(sum_casos)
plot(sum_fallecidos)
plot(sum_hospitalizados)
plot(sum_ingresos)
```

# Creación modelos

```{r}
lm1 <- lm(edades~sum, data=sum_fallecidos)
lm1
plot(sum_fallecidos)
abline(lm1)
summary(lm1)
plot(lm1)
```
 ### Se analiza el modelo: 
 Con respecto al summary:
- En el Coefficients se puede observar que en este caso no es muy significativo la variable "sum" ya que en el t_value esta cerca del 0 por tanto no es muy significante y en la probablididad de los valores sean significativos también aparece que no es muy significante y por tanto esta variable se podria quitar.
- En el R estimador tan solo es hay un 42,82% lo cuál indica que no es muy bueno el modelo y con respecto al R ajustado no son muy cercanos por tanto podria haber sobrecargado un poco el modelo.
- En el F-statistic no es muy alto pero sigue siendo mayor que 1 por tanto si H0=0 (hipotesis nula) entonces significa que al menos hay un modelo aqui.
- En el p-value es menor que el nivel de significancia(0,05) por tanto tomando la hipotesis planteada anterior se puede decir que aceptamos H1.
- En los grados de libretad son muy bajos por tanto no es muy bueno.

Con respecto a las gráficas: 
- 1 Gráfica : se observa que no es muy bueno el modelo  ya que los valores no se acercan a la linea y=0.Tambíen podemos ver valores que podrían ser significantes o outliers.
- 2 Gráfica : el modelo no se acerca a la linea y=x y la mayoria de los valores no estan distribuidas en ella por tanto es bastante malo el modelo.
- 3 Gráfica: Hay bastantes valores que pueden ser outliers o importantes y los valores son bastante dispersos por tanto tiene bastantes errores.Quitando los outliers se podría mejorar bastante la gráfica.
- 4 Gráfica: se sacan las mismas conclusiones y y se ven los valores outliers e importantes con la distancia de Cook para ver como de imporantes son los valores.

En general se observa que el modelo no es muy bueno y que se podria mejorar.

## Intentamos mejorarla convirtiendola a modelo no lineal

```{r}
lm1 <- lm(edades~I(sum)+I(sum^2), data=sum_fallecidos)
lm1
summary(lm1)
```
## Modelo logarítmico
```{r}
lm1 <- lm(edades~log(sum), data=sum_fallecidos)
lm1
summary(lm1)
```

En el caso de los fallecidos vemos como un ajuste logaritmico es el mejor, de modo que cuanto mayor sea la edad del contagiado, mayor será la posibilidad de fallecimiento.


```{r}
lm2 <- lm(edades~sum, data=sum_hospitalizados)
lm2
plot(sum_hospitalizados)
abline(lm2)
summary(lm2)
```

Como en el caso anterior vemos que este ajuste lineal no es lo más óptimo, de modo que buscamos otro mejor.

```{r}
lm2 <- lm(edades~I(sum)+I(sum^2), data=sum_hospitalizados)
lm2
summary(lm2)
```

```{r}
lm2 <- lm(edades~log(sum), data=sum_hospitalizados)
lm2
summary(lm2)
```
 En este caso ninguno mejora el ajuste lineal, por lo que no se ha podido encontrar ninguno útil, ya que son todos tienen una variabilidad representada del modelo (R-Squared) muy baja.



